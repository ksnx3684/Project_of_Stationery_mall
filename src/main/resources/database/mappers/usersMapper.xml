<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.stationery.project.users.UsersDAO">
	<insert id="join" parameterType="UsersDTO">
		INSERT INTO USERS (ID, PW, NAME, PHONE, EMAIL, GENDER, JOINDATE, USERACCOUNT, ADDRESSNAME,
		ADDRESSPHONE, POSTALCODE, ADDRESSDETAIL)
		VALUES (#{id}, #{pw}, #{name}, #{phone}, #{email}, #{gender}, SYSDATE, 1, #{addressName},
		#{addressPhone}, #{postalCode}, #{addressDetail})
	</insert>
	<select id="login" parameterType="UsersDTO" resultType="UsersDTO">
		SELECT ID, NAME FROM USERS WHERE ID = #{id} AND PW = #{pw}
	</select>
	<select id="wishlist" parameterType="UsersDTO" resultType="WishListDTO">
		SELECT * FROM WISHLIST WHERE ID = #{id}
	</select>
	<select id="mypage" parameterType="UsersDTO" resultType="UsersDTO">
		SELECT ID, NAME, PHONE, EMAIL, JOINDATE, ADDRESSNAME, ADDRESSPHONE, POSTALCODE, ADDRESSDETAIL
		FROM USERS WHERE ID = #{id}
	</select>
	<update id="infochange" parameterType="UsersDTO">
		<!-- UPDATE USERS SET PHONE = #{phone}, EMAIL = #{email}, ADDRESSNAME = #{addressName},
		ADDRESSPHONE = #{addressPhone}, POSTALCODE = #{postalCode}, ADDRESSDETAIL = #{addressDetail}
		WHERE ID = #{id} -->
		{CALL
        DECLARE
        BEGIN
            UPDATE USERS SET PHONE = '', EMAIL = '' WHERE ID = #{id};
            UPDATE USERS SET PHONE = #{phone}, EMAIL = #{email}, ADDRESSNAME = #{addressName},
			ADDRESSPHONE = #{addressPhone}, POSTALCODE = #{postalCode}, ADDRESSDETAIL = #{addressDetail}
			WHERE ID = #{id};
        END
    	}
	</update>
	<update id="pwchange" parameterType="UsersDTO">
		UPDATE USERS SET PW = #{pw} WHERE ID = #{id}
	</update>

</mapper>